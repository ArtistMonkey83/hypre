<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!--Converted with LaTeX2HTML 96.1-g (June 11, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>3.3 Setting Up the Struct Matrix</TITLE>
<META NAME="description" CONTENT="3.3 Setting Up the Struct Matrix">
<META NAME="keywords" CONTENT="usr_manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="usr_manual.css">
</HEAD>
<BODY LANG="EN" >
 <A NAME="tex2html246" HREF="node13.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="http://cbl.leeds.ac.uk/nikos/figs/next_motif.gif"></A> <A NAME="tex2html244" HREF="node9.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="http://cbl.leeds.ac.uk/nikos/figs/up_motif.gif"></A> <A NAME="tex2html238" HREF="node11.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="http://cbl.leeds.ac.uk/nikos/figs/previous_motif.gif"></A> <A NAME="tex2html248" HREF="node1.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="http://cbl.leeds.ac.uk/nikos/figs/contents_motif.gif"></A> <A NAME="tex2html249" HREF="node40.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="http://cbl.leeds.ac.uk/nikos/figs/index_motif.gif"></A> <BR>
<B> Next:</B> <A NAME="tex2html247" HREF="node13.html">3.4 Setting Up the </A>
<B>Up:</B> <A NAME="tex2html245" HREF="node9.html">3 Structured-Grid System Interface </A>
<B> Previous:</B> <A NAME="tex2html239" HREF="node11.html">3.2 Setting Up the </A>
<BR> <P>
<H1><A NAME="SECTION00430000000000000000">3.3 Setting Up the Struct Matrix</A></H1>
<P>
<A NAME="SettingUptheStructMatrix">&#160;</A>
<P>
The matrix is set up in terms of the grid and stencil objects
described in Sections
<A HREF="node10.html#SettingUptheStructGrid">3.1</A> and <A HREF="node11.html#SettingUptheStructStencil">3.2</A>.
The coefficients associated with each stencil entry will typically
vary from gridpoint to gridpoint, but in the example problem being
considered, they are as follows over the entire grid (except at
boundaries; see below):
<P><A NAME="eqnstencillaplacian">&#160;</A> <IMG WIDTH=500 HEIGHT=68 ALIGN=BOTTOM  SRC="img7.gif"  > <P>
<P>
On process 0, the following code will set up matrix values associated
with the center ( <IMG WIDTH=16 HEIGHT=25 ALIGN=MIDDLE  SRC="img5.gif"  > ) and south ( <IMG WIDTH=16 HEIGHT=25 ALIGN=MIDDLE  SRC="img6.gif"  > ) stencil entries in
(<A HREF="node11.html#eqnstencildescription">3.2</A>) / (<A HREF="node12.html#eqnstencillaplacian">3.3</A>)
(boundaries are ignored here temporarily).
<blockquote><PRE>HYPRE_StructMatrix  A;
double              values[36];
int                 stencil_indices[2] = {0,3};
int                 i;

HYPRE_StructMatrixCreate(MPI_COMM_WORLD, grid, stencil, &amp;A);
HYPRE_StructMatrixInitialize(A);

for (i = 0; i &lt; 36; i += 2)
{
   values[i]   =  4.0;
   values[i+1] = -1.0;
}

HYPRE_StructMatrixSetBoxValues(A, ilower[0], iupper[0], 2,
                               stencil_indices, values);
HYPRE_StructMatrixSetBoxValues(A, ilower[1], iupper[1], 2,
                               stencil_indices, values);

/* set boundary conditions */
...

HYPRE_StructMatrixAssemble(A);</PRE>
</blockquote>
The <code>Create()</code> routine creates an empty matrix object.  The
<code>Initialize()</code> routine indicates that the matrix coefficients
(or values) are ready to be set.  This routine may or may not involve
the allocation of memory for the coefficient data, depending on the
implementation.  The optional <code>Set</code> routines mentioned later in
this chapter and in the Reference Manual, should be called before this
step.  The <code>SetBoxValues()</code> routine sets the matrix coefficients
for some set of stencil entries over the gridpoints in some box.  Note
that the box need not correspond to any of the boxes used to create
the grid, but values should be set for all gridpoints that this
process ``owns''.  The <code>Assemble()</code> routine is a collective call,
and finalizes the matrix assembly, making the matrix ``ready to use''.
<P>
Matrix coefficients that reach outside of the boundary should be set
to zero.  For efficiency reasons, HYPRE does not do this
automatically.  The most natural time to insure this is when the
boundary conditions are being set, and this is most naturally done
after the coefficients on the grid's interior have been set.  For
example, during the implementation of the Dirichlet boundary condition
on the lower boundary of the grid in Figure <A HREF="node9.html#figfvgrid">3.1</A>, the
``south'' coefficient must be set to zero.  To do this on process 0,
the following code could be used:
<blockquote><PRE>int  ilower[2] = {-3, 1};
int  iupper[2] = { 2, 1};

/* create matrix and set interior coefficients */
...

/* implement boundary conditions */
...

for (i = 0; i &lt; 12; i++)
{
   values[i] =  0.0;
}

i = 3;
HYPRE_StructMatrixSetBoxValues(A, ilower, iupper, 1, &amp;i, values);

/* complete implementation of boundary conditions */
...</PRE>
</blockquote><HR><A NAME="tex2html246" HREF="node13.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="http://cbl.leeds.ac.uk/nikos/figs/next_motif.gif"></A> <A NAME="tex2html244" HREF="node9.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="http://cbl.leeds.ac.uk/nikos/figs/up_motif.gif"></A> <A NAME="tex2html238" HREF="node11.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="http://cbl.leeds.ac.uk/nikos/figs/previous_motif.gif"></A> <A NAME="tex2html248" HREF="node1.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="http://cbl.leeds.ac.uk/nikos/figs/contents_motif.gif"></A> <A NAME="tex2html249" HREF="node40.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="http://cbl.leeds.ac.uk/nikos/figs/index_motif.gif"></A> <BR>
<B> Next:</B> <A NAME="tex2html247" HREF="node13.html">3.4 Setting Up the </A>
<B>Up:</B> <A NAME="tex2html245" HREF="node9.html">3 Structured-Grid System Interface </A>
<B> Previous:</B> <A NAME="tex2html239" HREF="node11.html">3.2 Setting Up the </A>
<P><ADDRESS>
<I>Thomas Treadway <BR>
Fri Jul 27 10:01:25 PDT 2001</I>
</ADDRESS>
</BODY>
</HTML>
